---
import CardHelp from './CardHelp.astro';
---
<div
  id="active-ads-card"
  class="bg-[#161a1e] border border-white/10 rounded-2xl p-7 shadow-lg transition-all hover:border-[#F3BA2F]/20"
>
  <div class="flex flex-col gap-5">
    <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4">
      <div class="flex items-center gap-3">
        <div class="p-2 rounded-lg bg-[#F3BA2F]/10 border border-[#F3BA2F]/20">
          <i class="fas fa-bullhorn text-[#F3BA2F] text-sm"></i>
        </div>
        <div>
          <p class="sentinel-label text-white !text-sm font-bold">
            Ordenes P2P Activas
          </p>
          <p class="text-[12px] text-white/65 uppercase font-black tracking-[0.18em] mt-1">
            Estado en tiempo real por operador
          </p>
        </div>
        <CardHelp
          title="Ordenes P2P Activas"
          description="Lista ordenes/anuncios que Binance detecta activos para el operador."
          calculation="Activos = cantidad de ordenes/anuncios con estado operativo. Si no hay respuesta directa, el sistema infiere estado usando historial reciente de ordenes."
          notes={[
            "Se muestra fuente de deteccion: directo o inferido.",
            "La tabla incluye precio, cantidad, liquidez en Bs, metodos y estado."
          ]}
          align="left"
        />
      </div>

      <div class="flex items-center gap-3 self-start md:self-center">
        <div class="flex items-center gap-2">
          <span class="text-[12px] uppercase font-black tracking-[0.18em] text-white/70">
            Activos:
          </span>
          <span
            id="active-ads-count"
            class="text-xl font-mono font-bold text-[#F3BA2F] bg-[#F3BA2F]/10 px-3 py-1 rounded-lg border border-[#F3BA2F]/20"
          >
            0
          </span>
        </div>
        <button
          id="active-ads-toggle"
          type="button"
          aria-expanded="false"
          aria-controls="active-ads-content"
          class="inline-flex items-center gap-2 px-4 py-2 rounded-xl border border-white/10 bg-black/20 text-[11px] font-black uppercase tracking-[0.18em] text-white/70 hover:border-[#F3BA2F]/30 hover:text-[#F3BA2F] transition-all"
        >
          <span id="active-ads-toggle-label">Expandir</span>
          <svg
            id="active-ads-toggle-icon"
            class="w-4 h-4 transition-transform duration-300"
            viewBox="0 0 20 20"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            aria-hidden="true"
          >
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 8l4 4 4-4"></path>
          </svg>
        </button>
      </div>
    </div>

    <div
      id="active-ads-collapsed-summary"
      class="hidden grid grid-cols-1 sm:grid-cols-3 gap-3"
    >
      <div class="bg-black/20 p-3 rounded-xl border border-white/5 flex flex-col gap-1">
        <span class="sentinel-label !text-[11px] text-white/70">Deteccion</span>
        <span id="active-ads-collapsed-source" class="sentinel-value-md !text-base text-white tracking-normal">
          --
        </span>
      </div>
      <div class="bg-black/20 p-3 rounded-xl border border-white/5 flex flex-col gap-1">
        <span class="sentinel-label !text-[11px] text-white/70">Ultima revision</span>
        <span id="active-ads-collapsed-updated" class="sentinel-value-md !text-base text-white tracking-normal">
          --
        </span>
      </div>
      <div class="bg-black/20 p-3 rounded-xl border border-white/5 flex flex-col gap-1">
        <span class="sentinel-label !text-[11px] text-white/70">Liquidez total</span>
        <span id="active-ads-collapsed-total-fiat" class="sentinel-value-md !text-base text-white tracking-normal">
          --
        </span>
      </div>
    </div>

    <div id="active-ads-content" class="flex flex-col gap-5">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <div class="bg-black/20 p-3 rounded-xl border border-white/5 flex flex-col gap-1">
          <span class="sentinel-label !text-[11px] text-white/70">Metodo de deteccion</span>
          <span id="active-ads-source" class="sentinel-value-md !text-lg text-white tracking-normal">
            --
          </span>
        </div>
        <div class="bg-black/20 p-3 rounded-xl border border-white/5 flex flex-col gap-1">
          <span class="sentinel-label !text-[11px] text-white/70">Historial analizado</span>
          <span id="active-ads-window" class="sentinel-value-md !text-lg text-white tracking-normal">
            --
          </span>
        </div>
        <div class="bg-black/20 p-3 rounded-xl border border-white/5 flex flex-col gap-1">
          <span class="sentinel-label !text-[11px] text-white/70">Ultima revision</span>
          <span id="active-ads-updated" class="sentinel-value-md !text-lg text-white tracking-normal">
            --
          </span>
        </div>
        <div class="bg-black/20 p-3 rounded-xl border border-white/5 flex flex-col gap-1">
          <span class="sentinel-label !text-[11px] text-white/70">Liquidez total (Bs)</span>
          <span id="active-ads-total-fiat" class="sentinel-value-md !text-lg text-white tracking-normal">
            --
          </span>
        </div>
      </div>

      <p class="text-[12px] text-white/60">
        Directo: Binance reporta ordenes P2P activas. Inferido: se estima por historial de ordenes recientes.
      </p>

      <p
        id="active-ads-warning"
        class="hidden text-[13px] rounded-xl px-3 py-2 border"
      ></p>

      <div class="overflow-x-auto rounded-xl border border-white/5 bg-black/20">
        <table class="w-full min-w-[900px] text-left text-[14px]">
          <thead class="bg-black/40 text-white/75 uppercase text-[11px] tracking-[0.2em]">
            <tr>
              <th class="px-3 py-2 font-black">Anuncio</th>
              <th class="px-3 py-2 font-black">Tipo</th>
              <th class="px-3 py-2 font-black">Par</th>
              <th class="px-3 py-2 font-black">Precio</th>
              <th class="px-3 py-2 font-black">Cantidad / Liquidez Bs</th>
              <th class="px-3 py-2 font-black">Metodos</th>
              <th class="px-3 py-2 font-black">Ordenes</th>
              <th class="px-3 py-2 font-black">Estado</th>
            </tr>
          </thead>
          <tbody id="active-ads-table-body" class="text-white/90">
            <tr class="border-t border-white/5">
              <td class="px-3 py-3 text-white/50" colspan="8">
                Sin datos de ordenes P2P activas.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
