---
// src/pages/dashboard/index.astro
import DashboardLayout from '../../layouts/DashboardLayout.astro';
import StatCard from '../../components/dashboard/StatCard.astro';

// Importación de componentes modulares
import Operaciones from '../../components/dashboard/operaciones.astro';
import Comisiones from '../../components/dashboard/comisiones.astro';
import P2P from '../../components/dashboard/p2p.astro';
import Pay from '../../components/dashboard/pay.astro';
import Red from '../../components/dashboard/red.astro';
import Switch from '../../components/dashboard/switch.astro';
import Fiat from '../../components/dashboard/fiat.astro';
import Bancos from '../../components/dashboard/bancos.astro';
import Ciclos from '../../components/dashboard/ciclos.astro';
import Tasa from '../../components/dashboard/tasa.astro';
import Profit from '../../components/dashboard/profit.astro';
import ComisionOperador from '../../components/dashboard/ComisionOperador.astro'; 
import ProyeccionGanancias from '../../components/dashboard/ProyeccionGanancias.astro';
---

<DashboardLayout>
  <div class="flex justify-between items-center mb-6 px-2">
    <div>
      <h1 class="text-white font-black text-xl uppercase tracking-tighter">
        Bienvenido, <span id="operator-alias" class="text-[#F3BA2F]">Cargando...</span>
      </h1>
      <p id="last-update" class="text-[9px] text-gray-500 uppercase font-bold tracking-widest mt-1 italic">Sincronizando con Sentinel...</p>
      <p id="kpi-filter-label" class="text-[9px] text-gray-500 uppercase font-bold tracking-widest mt-1">Rango activo: Hoy</p>
    </div>
    <button id="logout-btn" class="bg-red-500/10 hover:bg-red-500/20 text-red-500 text-[10px] font-black py-2 px-4 rounded-xl border border-red-500/20 transition-all uppercase tracking-widest">
      Cerrar Sesión
    </button>
  </div>

  <section class="mb-8 bg-gradient-to-br from-[#0f1216] to-[#0b0d11] border border-gray-800 rounded-2xl p-4 shadow-lg shadow-black/20">
    <div class="flex items-center justify-between flex-wrap gap-2 mb-3">
      <div class="flex items-center gap-2">
        <span class="w-1 h-4 bg-[#F3BA2F]"></span>
        <p class="text-[10px] font-black uppercase tracking-[0.25em] text-gray-400">Filtro temporal KPI</p>
      </div>
    </div>

    <div class="flex flex-wrap gap-2 mb-4" id="kpi-preset-group">
      <button class="kpi-preset-btn px-3 py-2 rounded-xl text-xs font-bold uppercase tracking-wide border border-gray-800 bg-white/5 hover:border-[#F3BA2F]/60" data-preset="today">Hoy</button>
      <button class="kpi-preset-btn px-3 py-2 rounded-xl text-xs font-bold uppercase tracking-wide border border-gray-800 bg-white/5 hover:border-[#F3BA2F]/60" data-preset="this_week">Esta semana</button>
      <button class="kpi-preset-btn px-3 py-2 rounded-xl text-xs font-bold uppercase tracking-wide border border-gray-800 bg-white/5 hover:border-[#F3BA2F]/60" data-preset="last_7">Últimos 7 días</button>
      <button class="kpi-preset-btn px-3 py-2 rounded-xl text-xs font-bold uppercase tracking-wide border border-gray-800 bg-white/5 hover:border-[#F3BA2F]/60" data-preset="this_month">Mes actual</button>
      <button class="kpi-preset-btn px-3 py-2 rounded-xl text-xs font-bold uppercase tracking-wide border border-gray-800 bg-white/5 hover:border-[#F3BA2F]/60" data-preset="last_30">Últimos 30 días</button>
      <button class="kpi-preset-btn px-3 py-2 rounded-xl text-xs font-bold uppercase tracking-wide border border-gray-800 bg-white/5 hover:border-[#F3BA2F]/60" data-preset="all">Todo</button>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
      <div>
        <label class="text-[9px] font-black text-gray-500 uppercase mb-1 block">Desde</label>
        <input id="kpi-date-from" type="date" class="bg-black text-white text-xs border border-gray-700 p-3 rounded-xl w-full outline-none focus:border-[#F3BA2F]/70" />
      </div>
      <div>
        <label class="text-[9px] font-black text-gray-500 uppercase mb-1 block">Hasta</label>
        <input id="kpi-date-to" type="date" class="bg-black text-white text-xs border border-gray-700 p-3 rounded-xl w-full outline-none focus:border-[#F3BA2F]/70" />
      </div>
      <div class="flex items-end gap-2">
        <button id="kpi-apply-range" class="bg-[#F3BA2F] text-black text-[11px] font-black py-3 px-4 rounded-xl w-full uppercase tracking-wide hover:bg-[#d9a927] transition-all">Aplicar filtro</button>
      </div>
    </div>
  </section>

  <section class="mb-8">
    <h2 class="text-[#F3BA2F] text-[10px] font-black uppercase tracking-[0.2em] mb-4 italic flex items-center gap-2">
      <span class="w-1 h-3 bg-[#F3BA2F]"></span> 1. MÉTRICAS DE RENDIMIENTO CRÍTICO
    </h2>
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-4">
      <div class="lg:col-span-7">
        <Profit />
      </div>
      <div class="lg:col-span-5 flex flex-col gap-4">
        <Tasa />
        <Ciclos />
      </div>
    </div>
  </section>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
    <section>
      <h2 class="text-gray-500 text-[10px] font-black uppercase tracking-[0.2em] mb-4 italic font-bold">2. CONTROL DE OPERACIONES Y VOLUMEN</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
        <Operaciones />
        <Comisiones />
        <div id="kpi-margin"><StatCard title="Margen Global %" value="---" subValue="Beneficio neto" icon="fas fa-chart-line" /></div>
        <div id="ops-rates"><StatCard title="Tasas Globales PP" value="---" subValue="Compra / Venta" /></div>
      </div>
    </section>

    <section>
      <h2 class="text-gray-500 text-[10px] font-black uppercase tracking-[0.2em] mb-4 italic font-bold">4. PROYECCIONES E INSIGHTS</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <ProyeccionGanancias />
        <div class="flex flex-col gap-3">
            <ComisionOperador />
            <div id="kpi-profit"><StatCard title="Profit Total" value="---" subValue="Ganancia acumulada" icon="fas fa-coins" /></div>
        </div>
      </div>
    </section>
  </div>

  <section class="mb-8">
    <h2 class="text-gray-500 text-[10px] font-black uppercase tracking-[0.2em] mb-4 italic font-bold">3. LOGÍSTICA DE CARTERAS (BALANCES INTERNOS)</h2>
    <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
      <P2P />
      <Pay />
      <Red />
      <Switch />
      <Fiat />
    </div>
  </section>

  <section class="pb-20">
    <h2 class="text-gray-500 text-[10px] font-black uppercase tracking-[0.2em] mb-4 italic font-bold">5. PANEL DE BANCOS (CONTROL DE VOLUMEN)</h2>
    <Bancos />
  </section>

  <script>
    import { initDashboard } from '../../scripts/dashboard.js';
    initDashboard();
  </script>
</DashboardLayout>