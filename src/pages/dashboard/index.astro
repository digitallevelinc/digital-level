---
import DashboardLayout from '../../layouts/DashboardLayout.astro';
import StatCard from '../../components/dashboard/StatCard.astro';

const banks = [
  { name: 'Mercantil', color: 'border-l-blue-600' },
  { name: 'Banesco', color: 'border-l-green-600' },
  { name: 'BNC', color: 'border-l-orange-500' },
  { name: 'Provincial', color: 'border-l-blue-900' },
  { name: 'Pago Movil', color: 'border-l-yellow-500' },
  { name: 'Bancamiga', color: 'border-l-green-800' }
];
---

<DashboardLayout>
  <div class="flex justify-between items-center mb-6 px-2">
    <div>
      <h1 class="text-white font-black text-xl uppercase tracking-tighter">
        Bienvenido, <span id="operator-alias" class="text-[#F3BA2F]">Cargando...</span>
      </h1>
      <p id="last-update" class="text-[9px] text-gray-500 uppercase font-bold tracking-widest mt-1 italic">Sincronizando con Sentinel...</p>
    </div>
    <button id="logout-btn" class="bg-red-500/10 hover:bg-red-500/20 text-red-500 text-[10px] font-black py-2 px-4 rounded-xl border border-red-500/20 transition-all uppercase tracking-widest">
      Cerrar Sesión
    </button>
  </div>

  <section class="mb-8">
    <h2 class="text-[#F3BA2F] text-[10px] font-black uppercase tracking-[0.2em] mb-4 italic flex items-center gap-2">
      <span class="w-1 h-3 bg-[#F3BA2F]"></span> 1. MÉTRICAS DE RENDIMIENTO CRÍTICO
    </h2>
    <div class="grid grid-cols-1 md:grid-cols-5 gap-3">
      <div id="kpi-balance"><StatCard title="Balance Real Total" value="---" subValue="Suma total carteras" icon="fas fa-vault" /></div>
      <div id="kpi-breakeven"><StatCard title="Tasa Mínima Compra" value="---" type="warning" subValue="Break-even" icon="fas fa-shield-halved" /></div>
      <div id="kpi-margin"><StatCard title="Margen Global %" value="---" subValue="Beneficio neto" icon="fas fa-chart-line" /></div>
      <div id="kpi-profit"><StatCard title="Profit Total" value="---" subValue="Ganancia acumulada" icon="fas fa-coins" /></div>
      <div id="kpi-cycle"><StatCard title="Ganancia por Ciclo" value="---" type="success" subValue="Rendimiento actual" icon="fas fa-sync" /></div>
    </div>
  </section>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
    <section>
      <h2 class="text-gray-500 text-[10px] font-black uppercase tracking-[0.2em] mb-4 italic">2. CONTROL DE OPERACIONES Y VOLUMEN</h2>
      <div class="grid grid-cols-2 gap-3">
        <div id="ops-count"><StatCard title="Cantidad de Operaciones" value="---" subValue="Total ejecutadas" /></div>
        <div id="ops-rates"><StatCard title="Tasas Globales PP" value="---" subValue="Compra / Venta" /></div>
        <div id="ops-buys"><StatCard title="Compras Totales" value="---" subValue="Cargando..." /></div>
        <div id="ops-sells"><StatCard title="Ventas Totales" value="---" subValue="Cargando..." /></div>
        <div id="ops-fees"><StatCard title="Comisiones Totales" value="---" subValue="Costos operativos" /></div>
      </div>
    </section>

    <section>
      <h2 class="text-gray-500 text-[10px] font-black uppercase tracking-[0.2em] mb-4 italic">4. PROYECCIONES E INSIGHTS</h2>
      <div class="grid grid-cols-2 gap-3">
        <div id="proj-daily"><StatCard title="Ganancia Diaria" value="---" type="success" subValue="Últimas 24h" /></div>
        <div id="proj-vol"><StatCard title="Volumen Proyectado" value="---" subValue="Meta estimada" /></div>
        <StatCard title="Comisión Operador" value="60%" subValue="Configurado" />
        <div class="bg-[#161a1e] border border-gray-800 rounded-xl p-3 flex flex-col justify-center">
          <label class="text-[9px] font-bold text-gray-500 uppercase mb-2">Filtro Proyección Temporal</label>
          <select class="bg-black text-white text-xs border border-gray-700 p-2 rounded outline-none">
            <option>1 Día</option><option>1 Semana</option><option>15 Días</option><option>1 Mes</option>
          </select>
        </div>
      </div>
    </section>
  </div>

  <section class="mb-8">
    <h2 class="text-gray-500 text-[10px] font-black uppercase tracking-[0.2em] mb-4 italic">3. LOGÍSTICA DE CARTERAS (BALANCES INTERNOS)</h2>
    <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
      <div id="wallet-p2p"><StatCard title="Balance P2P" value="---" /></div>
      <div id="wallet-switch"><StatCard title="Balance Switch" value="---" /></div>
      
      <div id="wallet-red" class="relative group min-h-[160px] bg-gray-900/50 rounded-xl p-4 border border-white/5">
          <div class="flex justify-between items-start mb-4">
            <div>
              <p class="text-[10px] text-gray-500 font-black uppercase tracking-widest">Balance RED</p>
              <h3 class="text-2xl font-bold text-white mt-1">N/A</h3>
            </div>
            <i class="fas fa-network-wired text-gray-600"></i>
          </div>

          <div id="red-details" class="space-y-2 border-t border-white/5 pt-3">
            <div class="flex justify-between text-[10px]">
              <span class="text-gray-500 uppercase font-bold">Total Operaciones:</span>
              <span class="text-white font-mono">N/A</span>
            </div>
            
            <div class="flex justify-between text-[10px]">
              <span class="text-emerald-500/80 uppercase font-bold">Ingresos (Cant.):</span>
              <span class="text-emerald-400 font-mono">N/A</span>
            </div>
            <div class="flex justify-between text-[10px]">
              <span class="text-emerald-500/80 uppercase font-bold">Monto Ingresos:</span>
              <span class="text-emerald-400 font-mono">N/A</span>
            </div>

            <div class="flex justify-between text-[10px]">
              <span class="text-red-500/80 uppercase font-bold">Egresos (Cant.):</span>
              <span class="text-red-400 font-mono">N/A</span>
            </div>
            <div class="flex justify-between text-[10px]">
              <span class="text-red-500/80 uppercase font-bold">Monto Egresos:</span>
              <span class="text-red-400 font-mono">N/A</span>
            </div>
          </div>

          <a id="link-red-sheet" href="#" target="_blank" class="absolute top-4 right-10 opacity-20 hover:opacity-100 transition-all">
            <svg class="w-4 h-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
            </svg>
          </a>
        </div>

      <div id="wallet-pay"><StatCard title="Balance Pay" value="---" /></div>
      <div id="wallet-fiat"><StatCard title="Balance Fiat" value="---" /></div>
    </div>
  </section>

  <section class="pb-20">
    <h2 class="text-gray-500 text-[10px] font-black uppercase tracking-[0.2em] mb-4 italic">5. PANEL DE BANCOS (CONTROL DE VOLUMEN)</h2>
    <div class="bg-[#161a1e] border border-gray-800 rounded-xl overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full text-left text-[9px] border-collapse">
          <thead class="bg-black/40 text-gray-500 uppercase font-black border-b border-gray-800">
            <tr>
              <th class="px-3 py-4 text-white italic">Bancos Operando</th>
              <th class="px-3 py-4 text-center">Balance FIAT</th>
              <th class="px-3 py-4 text-center">Tasa Compra PP</th>
              <th class="px-3 py-4 text-center">Tasa Venta PP</th>
              <th class="px-3 py-4 text-center">Margen %</th>
              <th class="px-3 py-4 text-center text-[#F3BA2F]">Profit USDT ≈</th>
            </tr>
          </thead>
          <tbody id="bank-table-body" class="divide-y divide-gray-800/50">
            {banks.map(b => (
              <tr class={`hover:bg-white/[0.02] border-l-4 ${b.color}`}>
                <td class="px-3 py-4 font-bold text-white">{b.name}</td>
                <td colspan="5" class="px-3 py-4 text-center text-gray-600 animate-pulse italic">Esperando datos de Sentinel...</td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <script>
  // Astro detecta que este archivo vive en tu PC/Servidor de desarrollo,
  // lo procesa y genera la importación correcta automáticamente.
  import { initDashboard } from '../../scripts/dashboard.js';

  // Al llamar a la función aquí, te aseguras de que el JS 
  // se ejecute en cuanto el HTML esté listo.
  initDashboard();
</script>
</DashboardLayout>